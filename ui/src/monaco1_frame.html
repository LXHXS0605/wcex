<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0,width=device-width" />

    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        overflow: auto;
        margin: 0;
        padding: 0;
        font-size: 14px;
        background-color: transparent;
      }
      #contain {
        width: 100%;
        height: 100%;
        background-color: rebeccapurple;
      }
    </style>
  </head>
  <body>
    <div id="contain"></div>
  </body>
  <script>
    if (!window.__INIT_FLAG) {
      window.__INIT_FLAG = 1;
      console.warn("------FRAME ``", window.__INIT_FLAG);
      window.onload = () => {
        window.frameElement.dispatchEvent(new CustomEvent("monaco-init"));
      };
    }else{
      window.__INIT_FLAG++
      console.warn("------FRAM 22 ", window.__INIT_FLAG);
    }
    // window.__npm = location.hash.slice(1);
    // if(!window.__npm.endsWith('/')) window.__npm += '/';
    // var el = document.createElement("script");
    // el.src = window.__npm  + "monaco-editor/min/vs/loader.js";
    // document.body.appendChild(el);
    // window.frameElement.dispatchEvent(new CustomEvent('monaco-init'));

    // el.addEventListener('load',()=>{
    //   console.warn("------FRAME onload", location.hash);
    //   // 初始化monaco
    //   require.config({ paths: { vs: window.__npm + "monaco-editor/min/vs" } });
    //   require(["vs/editor/editor.main"], function () {
    //     monaco.editor.onDidCreateEditor((ed) => {
    //       ed.layout();
    //     });
    //     // 发送初始化完成事件
    //     window.frameElement.dispatchEvent(new CustomEvent('monaco-init'));

    //     // 监控父窗口变化，自动layout

    //     // let editor = monaco.editor.create(document.getElementById("contain"), {
    //     //   value: decodeURI("$text()"),
    //     //   language: "$language()",
    //     //   minimap: { enabled: false },
    //     //   theme: "$colorMode()",
    //     // });
    //     // window.__EDITOR = editor;

    //     // editor.onDidChangeModelContent(function (event) {
    //     //   // 执行相关操作
    //     //   window.frameElement.dispatchEvent(new CustomEvent("edit", { detail: { text: editor.getValue() } }));
    //     // });
    //     window.onmessage = (event) => {
    //       switch (event.data.type) {
    //         case "color":
    //           monaco.editor.setTheme(event.data.value);
    //           break;
    //         case "layout":
    //           editor.layout();
    //           break;
    //       }
    //     };
    //   });

    // })
  </script>
  <!-- <script src="$path(@/monaco-editor/min/vs/loader.js)"></script>
  <script>
    require.config({ paths: { vs: "$path(@/monaco-editor/min/vs)" } });
    require(["vs/editor/editor.main"], function () {
      monaco.editor.onDidCreateEditor((ed) => {
        ed.layout();
      });

      let editor = monaco.editor.create(document.getElementById("contain"), {
        value: decodeURI("$text()"),
        language: "$language()",
        minimap: { enabled: false },
        theme: "$colorMode()",
      });
      window.__EDITOR = editor;

      editor.onDidChangeModelContent(function (event) {
        // 执行相关操作
        window.frameElement.dispatchEvent(new CustomEvent('edit',{detail:{text:editor.getValue()}}))
      });
      window.onmessage = (event) => {
        switch (event.data.type) {
          case "color":
            monaco.editor.setTheme(event.data.value);
            break;
          case "layout":
            editor.layout();
            break;
        }
      };
    });
  </script> -->
</html>
