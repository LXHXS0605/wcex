<!-- 
    与路由绑定的导航栏,支持分区路由 支持水平或者垂直布局
    响应子项onClick事件,跳转到子项的属性href指向的路由
    解析当前路由, 监听当前路由变化，如果匹配则设置子项 checked 属性为 true

-->

<template vert.bool="0" @click.stop="onClick($ev)" route-area="default">
	<style>
		:host {
			display: flex;
			flex-direction: "$vert?'column':'row'";
			overflow-x: auto;
			gap: 1em;
		}
	</style>
	<slot id="slot" @slotchange="onSlotChange()"> </slot>
	<script scope=".">
		return class {
			onReady() {}
			onSlotChange() {
				let r = this.$router.route[this.routeArea];
				// 为匹配的子项设置 checked 属性
				this.$id.slot.assignedElements().forEach((item) => {
					let itemHash = item.getAttribute("href");
					// 比对区域路由
					let parsed = this.$router.parse(itemHash);
					let parsedRoute = parsed[this.routeArea];
					if (!parsedRoute) return;
					if (parsedRoute.tag && parsedRoute.tag != r.tag) return;
					// 比对路由参数
					for (let key of Object.keys(parsedRoute.attrs)) {
						if (parsedRoute.attrs[key] != r.attrs[key]) {
							return;
						}
					}
					item.setAttribute("checked", "1");
					this.$emit("click", item);
				});
			}

			onClick(ev) {
				console.log(ev.target);
				const href = ev.target.getAttribute("href");

				if (href) {
					this.$router.go(href);
				}
			}
		};
	</script>
</template>
