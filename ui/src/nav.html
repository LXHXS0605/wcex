<!-- 
    与路由绑定的导航栏,支持分区路由 支持水平或者垂直布局
    响应子项onClick事件,跳转到子项的属性href指向的路由
    解析当前路由, 监听当前路由变化，如果匹配则设置子项 checked 属性为 true

-->

<template vert.bool="0" @click.stop="onClick($ev)" route-name="default">
	<style>
		:host {
			display: flex;
			flex-direction: "$vert?'column':'row'";
			overflow-x: auto;
			gap: 1em;
		}
	</style>
	<slot id="slot" @slotchange="onSlotChange()"> </slot>
	<script scope=".">
		return class {
			onReady() {}
			/**
			 * 检查路由是否匹配
			 * @param {HTMLElement} el
			 */
			checkRouteMatch(el) {
				let r = this.$router.route[this.routeName];
				let href = el.getAttribute("href");
				if (!href || !r) return false;
				let parsed = this.$router.parse(href);
				let parsedRoute = parsed[this.routeName];
				if (!parsedRoute) return false;
				if (parsedRoute.tag && parsedRoute.tag != r.tag) return;
				// 比对路由参数
				for (let key of Object.keys(parsedRoute.attrs)) {
					if (parsedRoute.attrs[key] != r.attrs[key]) {
						return;
					}
				}
				el.setAttribute("checked", "1");
				this.$emit("click", el);
			}
			onSlotChange() {
				let r = this.$router.route[this.routeName];
				// 为匹配的子项设置 checked 属性
				this.$id.slot.assignedElements().forEach((item) => {
					this.checkRouteMatch(item);
					item.querySelectorAll("[href]").forEach((item) => {
						ithis.checkRouteMatch(item);
					});
				});
			}

			onClick(ev) {
				console.log(ev.target);
				const href = ev.target.getAttribute("href");

				if (href) {
					this.$router.go(href);
				}
			}
		};
	</script>
</template>
