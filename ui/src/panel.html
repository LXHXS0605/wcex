<!-- 实现可折叠的面板,通过value可绑定是否打开或者关闭 -->
<!-- 
  具有标题栏的可收缩面板
  标题区、内容区、以及动作区
  可调整颜色
 -->
<template
  open.bool="true"
  $color="$color.pri"
  icon="circle"
  icon-type="filled"
  icon-pkg="mdi"
  icon-size.float="1.5"
  closeable.bool="false"
  textonly.bool="false"
>
  <link rel="stylesheet" href="./css/shadow.css" />
  <link rel="stylesheet" href="./ui.css" />

  <style>
    :host {
      --title-shadow: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .panel {
      height: "$open?panelHeight+'px':0";
    }
    .title {
      background-color: "$open?color:color.s8_.l1";
      color: "$$color.textr";
      padding: 0.5em 0.5em;
      text-align: "$textonly?'center':'left'";
    }
    .title:active {
      background-color: "$closeable?color.l1_:''";
    }
  </style>

  <div :class="title row trans ${open?'shadow':''} nowrap" style="user-select: none" @click="if(closeable)open=!open">
    <wcex-ui.icon
      slot="icon"
      $color="$root.color.l4_"
      $icon="$root.icon"
      $size="iconSize"
      $pkg="iconPkg"
      $type="iconType"
      :style="margin-right: 1em"
      $if="!textonly"
    ></wcex-ui.icon>
    <h4 style="flex: 1"><slot name="title"></slot></h4>
    <!-- 打开指示条 -->
    <wcex-ui.icon
      active
      slot="end"
      $color="$color.sec.l3_"
      $icon="open?'double_arrow':'arrow_right'"
      :style="transform: rotate(${open?90:0}deg);"
      $if="closeable && !textonly"
    ></wcex-ui.icon>
  </div>

  <!-- 可折叠面板 -->
  <div class="panel trans"><slot id="slot"></slot></div>

  <script scope=".">
    return class {
      panelHeight = 0;
      onReady() {
        this.update();
        let el = this.$id.slot.assignedElements()[0];
        this.$log("--- assignedElements:", el);
        if (el) {
          this.$monitSize(el, (sz) => {
            this.update();
          });
        }
      }
      update() {
        let el = this.$id.slot.assignedElements()[0];
        this.panelHeight = el && el.clientHeight;
      }
    };
  </script>
</template>
